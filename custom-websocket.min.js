(function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.CustomWebSocket=b()})(this,function(){function a(b,c,d){function f(a,b){return Object.assign(new CustomEvent(a),b||[])}function g(...b){(j.debug||a.debugAll)&&console.debug(...b)}var e={debug:!1,automaticOpen:!0,heartbeat:!0,heartbeatInterval:6e4,binaryType:"blob",shouldReconnect:function(a,b){return 10<b&&(b=10),500*Math.pow(1.5,b)}};for(var h in d||(d={}),e)this[h]="undefined"==typeof d[h]?e[h]:d[h];this.url=b,this.readyState=WebSocket.CONNECTING,this.protocol=null;var i,j=this,k=!1,l=document.createElement("div");l.addEventListener("open",function(a){j.onopen(a)}),l.addEventListener("close",function(a){j.onclose(a)}),l.addEventListener("connecting",function(a){j.onconnecting(a)}),l.addEventListener("message",function(a){j.onmessage(a)}),l.addEventListener("error",function(a){j.onerror(a)}),this.addEventListener=l.addEventListener.bind(l),this.removeEventListener=l.removeEventListener.bind(l),this.dispatchEvent=l.dispatchEvent.bind(l),this.open=function(){i=new WebSocket(j.url,c||[]),i.binaryType=this.binaryType,l.dispatchEvent(f("connecting")),g("CustomWebSocket","attempt-connect",j.url);var a=null;i.onopen=function(){g("CustomWebSocket","onopen",j.url),j.protocol=i.protocol,j.readyState=WebSocket.OPEN,j.attempts=0;var b=f("open");l.dispatchEvent(b),j.heartbeat&&(a=setInterval(function(){i.readyState==WebSocket.OPEN?(i.send("PING"),g("CustomWebSocket","send-PING",j.url)):clearInterval(a)},j.heartbeatInterval))},i.onclose=function(b){if(g("CustomWebSocket","onclose",j.url),clearInterval(a),i=null,k)g("CustomWebSocket","explicitly-closed",j.url,"Closed explicitly. Will not try to reconnect."),j.readyState=WebSocket.CLOSED,l.dispatchEvent(f("close"));else{var c=null;"function"==typeof j.shouldReconnect&&(c=j.shouldReconnect(b,j.attempts)),"number"==typeof j.shouldReconnect&&(c=j.shouldReconnect),c&&setTimeout(function(){g("CustomWebSocket","reconnecting",j.url),j.attempts++,j.open()},c)}},i.onmessage=function(a){g("CustomWebSocket","onmessage",j.url,a.data);var b=f("message");b.data=a.data,l.dispatchEvent(b)},i.onerror=function(a){g("CustomWebSocket","onerror",j.url,a),l.dispatchEvent(f("error"))}},!0==this.automaticOpen&&this.open(),this.send=function(a){if(i)return g("CustomWebSocket","send",j.url,a),i.send(a);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(a,b){"undefined"==typeof a&&(a=1e3),k=!0,i&&i.close(a,b)}}if("WebSocket"in window)return a.prototype.onopen=function(){},a.prototype.onclose=function(){},a.prototype.onconnecting=function(){},a.prototype.onmessage=function(){},a.prototype.onerror=function(){},a.debugAll=!1,a});